# ppm-filter

Προγραμματισμός Υπολογιστών με C++
2η Εργασία – Ακαδημαϊκό Έτος 2018-19

Ημερομηνία Παράδοσης Εργασίας: 6 Ιανουαρίου 2019, ομάδες 1-2 ατόμων

1. Εκφώνηση

Χρησιμοποιώντας ως βάση τον κώδικα που αναπτύξατε στην πρώτη εργασία, υλοποιείστε τα ακόλουθα:

Μεταφέρετε τη λειτουργικότητα και υλοποίηση της κλάσης Image σε μια templated κλάση math::Array (που ανήκει επομένως στο namespace math) και προσαρμόστε την κατάλληλα ώστε όπου πριν είχατε τον τύπο Color τώρα να χρησιμοποιείται ο άγνωστος τύπος T:

Αλλάξτε στη νέα κλάση Array την εσωτερική αναπαράσταση των δεδομένων (buffer) ώστε αντί για T * buffer να είναι std::vector buffer.
Αλλάξτε στη νέα κλάση όσα ονόματα χρησιμοποιούσαν το συστατικό «Pixel» ώστε στην κλάση Array να είναι πιο αφηρημένα.
Καταργήστε τις μεθόδους load και save από τη νέα κλάση Array.
Προσθέστε έναν νέο τελεστή () έτσι ώστε αν έχετε ένα στιγμιότυπο της Array arr, η arr(i,j) να επιστρέφει αναφορά στο στοιχείο τύπου Τ στη γραμμή j και στήλη i.
Δηλώστε την κλάση Image ως απόγονο της κλάσης Array<Τ>, με τον τύπο Τ να είναι math::Vec3 1. H κλάση Vec3 ορίζεται στο αρχείο Vec3.h. Η κλάση Image έχει, επιπλέον των μεθόδων της Array, τις μεθόδους load() και save() που είχε και στην 1η εργασία. Οι δύο αυτές μέθοδοι εξακολουθούν να πρέπει να χρησιμοποιούν τις συναρτήσεις ReadPPM και WritePPM της βιβλιοθήκης ppm.lib.

Δηλώστε και υλοποιήστε μια βασική κλάση Filter της οποίας ο ρόλος είναι να υλοποιεί ένα φίλτρο επεξεργασίας εικόνας. Η μόνη μέθοδος που διαθέτει η κλάση Filter είναι η pure virtual μέθοδος: Image operator << (const Image & image) Η μέθοδος αυτή επενεργεί πάνω σε μια εικόνα (βλ. παρακάτω) και να την αλλοιώνει, παράγοντας μια νέα και θα πρέπει να μπορεί να κληθεί πολυμορφικά για τους απογόνους της κλάσης Filter. Οι απόγονοι αυτής της κλάσης θα υλοποιούν διαφορετικά ο κάθε ένας αυτή τη μέθοδο, ανάλογα με το είδος του φίλτρου. Η κλάση θα πρέπει να διαθέτει επίσης τους κατάλληλους constructors (default, copy).

Δηλώστε και υλοποιήστε δύο εξειδικευμένα φίλτρα ως απογόνους της βασικής κλάσης Filter, σύμφωνα με το παρακάτω διάγραμμα κληρονομικότητας:



H κάθε μία υλοποιεί με διαφορετικό τρόπο τον τελεστή << που κληρονομεί. Συγκεκριμένα, η FilterLinear εφαρμόζει σε κάθε Pixel p(x,y) της εικόνας εισόδου (δεξιός τελεστέος) τον τύπο:

p'(x,y) = a * p(x,y) + c
Όπου p'(x,y) το εικονοστοιχείο στη συντεταγμένη (x,y) της εικόνας που δημιουργεί και επιστρέφει ο τελεστής και a,c δύο σταθερές τιμές math::Vec3. Για παράδειγμα, αν a= (− 1,− 1,− 1 ) και c=(1,1,1) το φίλτρο θα πρέπει να παράγει το αρνητικό της πρωτότυπης εικόνας, όπως και στην πρώτη εργασία. Σημείωση: όλα τα αποτελέσματα της παραπάνω πράξης θα πρέπει να τα περιορίζετε στο διάστημα [0,1] για κάθε κανάλι χρώματος. Ο τελεστής << της FilterGamma υλοποιεί την πράξη:

p′(x,y) = p(x,y)^𝛾
όπου κάθε κανάλι χρώματος ενός εικονοστοιχείου υψώνεται στον εκθέτη γ. Τυπικές τιμές για το γ μεταξύ του 0.5 και του 2.0. Οι κλάσεις FilterLinear και FilterGamma πρέπει να διαθέτουν επιπρόσθετα πεδία από τη βασική κλάση για να φυλάνε τις παραμέτρους τους, καθώς και τους αντίστοιχους κατασκευαστές.

Υλοποιήστε μια κύρια εφαρμογή η οποία θα παράγει ένα εκτελέσιμο με όνομα filter.exe για τη Release έκδοση και filterd.exe για τη Debug έκδοση. Για τη δημιουργία του εκτελέσιμου θα πρέπει να συνδέσετε τη βιβλιοθήκη ppm.lib (την αντίστοιχη Debug ή Release έκδοσή της) που φτιάξατε στην πρώτη εργασία. Αν δεν την έχετε φτιάξει ήδη, θα πρέπει να την υλοποιήσετε στα πλαίσια της δεύτερης εργασίας. Η εφαρμογή, αφού φορτώσει μια εικόνα ppm που προσδιορίζουμε από την κονσόλα, θα εφαρμόζει πάνω σε αυτή μια σειρά από φίλτρα επεξεργασίας εικόνας των παραπάνω 2 τύπων. Ο τύπος, ο αριθμός και η σειρά των φίλτρων εικόνας που θα επενεργούν πάνω στην εικόνα προσδιορίζονται κι αυτά από τα ορίσματα της εφαρμογής. Η τροποποιημένη εικόνα θα πρέπει να αποθηκεύεται σε αρχείο ppm κι αυτή, αφού πρώτα αλλαχθεί το όνομα αρχείου προσθέτοντας το πρόθεμα “filtered_” στην αρχή του ονόματος της εικόνας εισόδου. Ο τρόπος εκτέλεσης του προγράμματος ακολουθεί το παρακάτω μοτίβο:

filter -f [φίλτρο 1] [παράμετροι] ... -f [φιλτρο k] [παράμετροι] [όνομα αρχείου εικόνας]
Μετά τον προσδιοριστή –f ακολουθεί το όνομα του φίλτρου, που μπορεί να είναι είτε linear είτε gamma και αμέσως μετά μια σειρά από ορίσματα που αντιστοιχούν στις εξειδικευμένες παραμέτρους του κάθε φίλτρου. Το φίλτρο linear θα πρέπει να ακολουθείται από 6 αριθμούς float που αντιστοιχούν στις συντεταγμένες των και a , c διανυσμάτων. Το φίλτρο gamma ακολουθείται από 1 παράμετρο που αντιστοιχεί στον εκθέτη γ. Συνοπτικά, η παραμετροποίηση φαίνεται στον ακόλουθο πίνακα:

Kλάση που υλοποιεί το φίλτρο	Προσδιοριστής φίλτρου	Παράμετροι
FilterLinear	linear	aR aG aB cR cG cB
FilterGamma	gamma	γ
Το αρχείο εικόνας εισόδου δίνεται πάντα τελευταίο. Αν δε δοθεί φίλτρο, η εφαρμογή πρέπει να τερματίζει χωρίς να κάνει τίποτα. Αν δεν προσδιοριστεί αρχείο ή δε δοθεί το όνομα κάποιου φίλτρου σωστά (ή καθόλου), η εφαρμογή πρέπει να βγάζει σχετικό μήνυμα λάθους και να τερματίζει.

Ο αριθμός των φίλτρων και το είδος τους προσδιορίζεται κατά την εκτέλεση με βάση τις παραμέτρους που παίρνει η εφαρμογή από τη γραμμή εντολών. Επίσης, ένα φίλτρο ενδέχεται να εφαρμόζεται πολλαπλές φορές και με διαφορετικές παραμέτρους κάθε φορά. Η σειρά εφαρμογής των φίλτρων είναι από αριστερά προς δεξιά. Παραδείγματα:









2. Γενικές οδηγίες

Για την υλοποίηση των προγραμμάτων, μπορείτε να χρησιμοποιήσετε όποιο περιβάλλον θέλετε αλλά ο κώδικας που θα παραδώσετε θα πρέπει να μπορεί να γίνει compile και link είτε με τον gcc σε περιβάλλον Windows, είτε με το Visual Studio 2015 , πάλι προφανώς σε περιβάλλον Windows. Παραδίδετε έτοιμο Visual Studio project ή αντίστοιχα makefile (για τον gcc) και όχι μόνο τα .cpp και .h αρχεία και έχετε επιβεβαιώσει ότι γίνονται σωστά build. Πριν ανεβάσετε την εργασία σας, καθαρίστε τα παραγόμενα από το Visual Studio αρχεία (Build→Clean Solution και διαγραφή του αρχείου .sdf από το solution directory).

Μπορείτε να ελέγξετε το αποτέλεσμα με το λογισμικό προεπισκόπισης που σας δίνεται στο eclass ή με οποιοδήποτε άλλο πρόγραμμα που αναγνωρίζει το μορφώτυπο PPM.

Προσοχή: Σε οποιαδήποτε περίπτωση διαπιστωθεί αντιγραφή κώδικα ή αδυναμία του εξεταζομένου φοιτητή να εξηγήσει την υλοποίησή του, η εργασία μηδενίζεται αυτομάτως. Επίσης, το εκτελέσιμο της εργασίας πρέπει να δουλεύει για να βαθμολογηθεί η τελευταία.
